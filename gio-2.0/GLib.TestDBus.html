<?xml version="1.0" encoding="utf-8"?>
<html>
  <head>
    <meta charset="UTF-8"/>
    <title>GLib.TestDBus &ndash; gio-2.0 &ndash; Vala Binding Reference</title>
    <link href="../style.css" rel="stylesheet" type="text/css"/><script src="../scripts.js" type="text/javascript">
    </script>
  </head>
  <body>
    <div class="site_header">GLib.TestDBus &ndash; gio-2.0 Reference Manual</div>
    <div class="site_body">
      <div class="site_navigation">
        <ul class="navi_main">
          <li class="package_index"><a href="../index.html">Packages</a></li>
        </ul>
        <hr class="navi_hr"/>
        <ul class="navi_main">
          <li class="package"><a href="index.htm">gio-2.0</a></li>
        </ul>
        <hr class="navi_hr"/>
        <ul class="navi_main">
          <li class="namespace"><a href="GLib.html">GLib</a></li>
        </ul>
        <hr class="navi_hr"/>
        <ul class="navi_main">
          <li class="class">TestDBus</li>
        </ul>
        <hr class="navi_hr"/>
        <ul class="navi_main">
          <li class="property"><a href="GLib.TestDBus.flags.html">flags</a></li>
          <li class="static_method"><a href="GLib.TestDBus.unset.html">unset</a></li>
          <li class="creation_method"><a href="GLib.TestDBus.TestDBus.html">TestDBus</a></li>
          <li class="method"><a href="GLib.TestDBus.add_service_dir.html">add_service_dir</a></li>
          <li class="method"><a href="GLib.TestDBus.down.html">down</a></li>
          <li class="method"><a href="GLib.TestDBus.get_bus_address.html">get_bus_address</a></li>
          <li class="method"><a href="GLib.TestDBus.get_flags.html">get_flags</a></li>
          <li class="method"><a href="GLib.TestDBus.stop.html">stop</a></li>
          <li class="method"><a href="GLib.TestDBus.up.html">up</a></li>
        </ul>
      </div>
      <div class="site_content">
        <h1 class="main_title">TestDBus</h1>
        <hr class="main_hr"/>
        <h2 class="main_title">Object Hierarchy:</h2>
        <img class="main_diagram" usemap="#GLib.TestDBus" alt="Object hierarchy for TestDBus" src="img/GLib.TestDBus.png"/>

      <map id="GLib.TestDBus" name="GLib.TestDBus">
<area shape="rect" id="node1" href="GLib.TestDBus.html" title="GLib.TestDBus" alt="" coords="5,101,141,149"/>
<area shape="rect" id="node2" href="../gobject-2.0/GLib.Object.html" title="GLib.Object" alt="" coords="17,5,129,53"/>
</map>

        <h2 class="main_title">Description:</h2>
        <div class="main_code_definition"><span class="main_keyword">public</span> <span class="main_keyword">class</span> <b><span class="class">TestDBus</span></b> : <span class="main_type"><a href="../gobject-2.0/GLib.Object.html" class="class">Object</a></span>
        </div>
        <div class="description">
          <p>A helper class for testing code which uses D-Bus without touching the user's session bus.</p>
          <p>Note that <span class="class">TestDBus</span> modifies the userâ€™s environment, calling <code>setenv</code>. This is not thread-safe, so
             all <span class="class">TestDBus</span> calls should be completed before threads are spawned, or should have appropriate locking to 
            ensure no access conflicts to environment variables shared between <span class="class">TestDBus</span> and other threads.</p>
          <h2> Creating unit tests using GTestDBus</h2>
          <p>Testing of D-Bus services can be tricky because normally we only ever run D-Bus services over an existing instance of the D-Bus daemon 
            thus we usually don't activate D-Bus services that are not yet installed into the target system. The <span class="class">TestDBus</span> 
            object makes this easier for us by taking care of the lower level tasks such as running a private D-Bus daemon and looking up uninstalled 
            services in customizable locations, typically in your source code tree.</p>
          <p>The first thing you will need is a separate service description file for the D-Bus daemon. Typically a `services` subdirectory of your 
            `tests` directory is a good place to put this file.</p>
          <p>The service file should list your service along with an absolute path to the uninstalled service executable in your source tree. Using 
            autotools we would achieve this by adding a file such as `my-server.service.in` in the services directory and have it processed by 
            configure. <pre class="main_source">    [D-BUS Service]<br/>    Name=org.gtk.GDBus.Examples.ObjectManager<br/>    Exec=@abs_top_builddir@/gio/tests/gdbus-example-objectmanager-server</pre>
             You will also need to indicate this service directory in your test fixtures, so you will need to pass the path while compiling your test 
            cases. Typically this is done with autotools with an added preprocessor flag specified to compile your tests such as: <pre class="main_source">    -DTEST_SERVICES=\""$(abs_top_builddir)/tests/services"\"</pre>
              Once you have a service definition file which is local to your source tree, you can proceed to set up a GTest fixture using the 
            <span class="class">TestDBus</span> scaffolding.</p>
          <p>An example of a test fixture for D-Bus services can be found here: 
            <a href="https://git.gnome.org/browse/glib/tree/gio/tests/gdbus-test-fixture.c">gdbus-test-fixture.c</a></p>
          <p>Note that these examples only deal with isolating the D-Bus aspect of your service. To successfully run isolated unit tests on your 
            service you may need some additional modifications to your test case fixture. For example; if your service uses GSettings and installs a 
            schema then it is important that your test service not load the schema in the ordinary installed location (chances are that your service 
            and schema files are not yet installed, or worse; there is an older version of the schema file sitting in the install location).</p>
          <p>Most of the time we can work around these obstacles using the environment. Since the environment is inherited by the D-Bus daemon created
             by <span class="class">TestDBus</span> and then in turn inherited by any services the D-Bus daemon activates, using the setup routine for
             your fixture is a practical place to help sandbox your runtime environment. For the rather typical GSettings case we can work around this
             by setting `GSETTINGS_SCHEMA_DIR` to the in tree directory holding your schemas in the above <code>fixture_setup</code> routine.</p>
          <p>The GSettings schemas need to be locally pre-compiled for this to work. This can be achieved by compiling the schemas locally as a step 
            before running test cases, an autotools setup might do the following in the directory holding schemas: <pre class="main_source">    all-am:<br/>            $(GLIB_COMPILE_SCHEMAS) .<br/><br/>    CLEANFILES += gschemas.compiled</pre>
          </p>
        </div><br/>
        <div class="namespace_note"><b>Namespace:</b> <a href="GLib.html">GLib</a>
        </div>
        <div class="package_note"><b>Package:</b> <a href="index.htm">gio-2.0</a>
        </div>
        <h2 class="main_title">Content:</h2>
        <h3 class="main_title">Properties:</h3>
        <ul class="navi_inline">
          <li class="property"><span class="leaf_code_definition"><span class="main_keyword">public</span> <span class="main_type"><a href="GLib.TestDBusFlags.html" class="enum">TestDBusFlags</a></span> <b><a href="GLib.TestDBus.flags.html" class="property">flags</a></b> { <span class="main_keyword">construct</span>; <span class="main_keyword">get</span>; }
            </span>
            <div class="leaf_brief_description"><span class="brief_description"><a href="GLib.TestDBusFlags.html" class="enum">TestDBusFlags</a> 
                specifying the behaviour of the D-Bus session.</span>
            </div></li>
        </ul>
        <h3 class="main_title">Static methods:</h3>
        <ul class="navi_inline">
          <li class="static_method"><span class="leaf_code_definition"><span class="main_keyword">public</span> <span class="main_keyword">static</span> <span class="main_keyword">void</span> <b><a href="GLib.TestDBus.unset.html" class="static_method">unset</a></b> ()
            </span>
            <div class="leaf_brief_description"><span class="brief_description">Unset DISPLAY and DBUS_SESSION_BUS_ADDRESS env variables to ensure the
                 test won't use user's session bus.</span>
            </div></li>
        </ul>
        <h3 class="main_title">Creation methods:</h3>
        <ul class="navi_inline">
          <li class="creation_method"><span class="leaf_code_definition"><span class="main_keyword">public</span> <b><a href="GLib.TestDBus.TestDBus.html" class="creation_method">TestDBus</a></b> (<span class="main_type"><a href="GLib.TestDBusFlags.html" class="enum">TestDBusFlags</a></span> flags)
            </span>
            <div class="leaf_brief_description"><span class="brief_description">Create a new <span class="class">TestDBus</span> object.</span>
            </div></li>
        </ul>
        <h3 class="main_title">Methods:</h3>
        <ul class="navi_inline">
          <li class="method"><span class="leaf_code_definition"><span class="main_keyword">public</span> <span class="main_keyword">void</span> <b><a href="GLib.TestDBus.add_service_dir.html" class="method">add_service_dir</a></b> (<span class="main_basic_type"><a href="../glib-2.0/string.html" class="class">string</a></span> path)
            </span>
            <div class="leaf_brief_description"><span class="brief_description">Add a path where dbus-daemon will look up .</span>
            </div></li>
          <li class="method"><span class="leaf_code_definition"><span class="main_keyword">public</span> <span class="main_keyword">void</span> <b><a href="GLib.TestDBus.down.html" class="method">down</a></b> ()
            </span>
            <div class="leaf_brief_description"><span class="brief_description">Stop the session bus started by 
                <a href="GLib.TestDBus.up.html" class="method">up</a>.</span>
            </div></li>
          <li class="method"><span class="leaf_code_definition"><span class="main_keyword">public</span> <span class="main_keyword">unowned</span> <span class="main_basic_type"><a href="../glib-2.0/string.html" class="class">string</a></span> <b><a href="GLib.TestDBus.get_bus_address.html" class="method">get_bus_address</a></b> ()
            </span>
            <div class="leaf_brief_description"><span class="brief_description">Get the address on which dbus-daemon is running.</span>
            </div></li>
          <li class="method"><span class="leaf_code_definition"><span class="main_keyword">public</span> <span class="main_type"><a href="GLib.TestDBusFlags.html" class="enum">TestDBusFlags</a></span> <b><a href="GLib.TestDBus.get_flags.html" class="method">get_flags</a></b> ()
            </span>
            <div class="leaf_brief_description"><span class="brief_description">Get the flags of the <span class="class">TestDBus</span> object.
              </span>
            </div></li>
          <li class="method"><span class="leaf_code_definition"><span class="main_keyword">public</span> <span class="main_keyword">void</span> <b><a href="GLib.TestDBus.stop.html" class="method">stop</a></b> ()
            </span>
            <div class="leaf_brief_description"><span class="brief_description">Stop the session bus started by 
                <a href="GLib.TestDBus.up.html" class="method">up</a>.</span>
            </div></li>
          <li class="method"><span class="leaf_code_definition"><span class="main_keyword">public</span> <span class="main_keyword">void</span> <b><a href="GLib.TestDBus.up.html" class="method">up</a></b> ()
            </span>
            <div class="leaf_brief_description"><span class="brief_description">Start a dbus-daemon instance and set DBUS_SESSION_BUS_ADDRESS.</span>
            </div></li>
        </ul>
        <h3 class="main_title">Inherited Members:</h3>
        <div class="box">
          <div class="headline">
            <div class="text">All known members inherited from class GLib.Object</div>
            <div class="toggle">
              <img onclick="toggle_box  (this, 'box-content-244')" src="../coll_open.png">&nbsp;</div>
            </div>
            <div class="content" id="box-content-244">
              <div class="column">
                <ul class="navi_inline">
                  <li class="static_method"><a href="../gobject-2.0/GLib.Object.@new.html">@new</a></li>
                  <li class="static_method"><a href="../gobject-2.0/GLib.Object.newv.html">newv</a></li>
                  <li class="static_method"><a href="../gobject-2.0/GLib.Object.new_valist.html">new_valist</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.get_type.html">get_type</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.get_class.html">get_class</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.@ref.html">@ref</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.unref.html">unref</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.ref_sink.html">ref_sink</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.weak_ref.html">weak_ref</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.weak_unref.html">weak_unref</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.add_weak_pointer.html">add_weak_pointer</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.remove_weak_pointer.html">remove_weak_pointer</a></li>
                </ul>
              </div>
              <div class="column">
                <ul class="navi_inline">
                  <li class="method"><a href="../gobject-2.0/GLib.Object.@get.html">@get</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.@set.html">@set</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.get_property.html">get_property</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.set_property.html">set_property</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.get_data.html">get_data</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.set_data.html">set_data</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.set_data_full.html">set_data_full</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.steal_data.html">steal_data</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.get_qdata.html">get_qdata</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.set_qdata.html">set_qdata</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.set_qdata_full.html">set_qdata_full</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.steal_qdata.html">steal_qdata</a></li>
                </ul>
              </div>
              <div class="column">
                <ul class="navi_inline">
                  <li class="method"><a href="../gobject-2.0/GLib.Object.freeze_notify.html">freeze_notify</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.thaw_notify.html">thaw_notify</a></li>
                  <li class="virtual_method"><a href="../gobject-2.0/GLib.Object.dispose.html">dispose</a></li>
                  <li class="virtual_method"><a href="../gobject-2.0/GLib.Object.constructed.html">constructed</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.notify_property.html">notify_property</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.connect.html">connect</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.disconnect.html">disconnect</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.add_toggle_ref.html">add_toggle_ref</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.remove_toggle_ref.html">remove_toggle_ref</a></li>
                  <li class="method"><a href="../gobject-2.0/GLib.Object.bind_property.html">bind_property</a></li>
                  <li class="signal"><a href="../gobject-2.0/GLib.Object.notify.html">notify</a></li>
                  <li class="field"><a href="../gobject-2.0/GLib.Object.ref_count.html">ref_count</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div><br/>
      <div class="site_footer">Generated by <a href="http://www.valadoc.org/">Valadoc</a>
      </div>
    </body>
  </html>